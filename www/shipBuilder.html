<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="all" href="CSS/ShipBuilder.css" />
    <link rel="stylesheet" type="text/css" media="all" href="CSS/Controller.css" />   
    <link rel="manifest" href="./manifest.manifest">    
</head>
<body>

<div id = "GUI" style = "display: block">
    
    <div id = "PartSelection" class = "SideMenu"></div>

    <center>
    <canvas id="canvas">
    </canvas>
    </center>

    <div id = "TypeSelection" class = "SideMenu">
        <button onclick="SetType(4)" class="ButtonTypes"> 
            <img src="Sprites/Buttons/ThrusterButton.png" id = "Engine" class="TypeImg">
        </button>
        <button onclick="SetType(1)" class="ButtonTypes"> 
            <img src="Sprites/Buttons/HullButton.png" id = "Hull" class="TypeImg">
        </button>
        <button onclick="SetType(3)" class="ButtonTypes"> 
            <img src="Sprites/Buttons/WeaponsButton.png" id = "Weapons" class="TypeImg">
        </button>
        <button onclick="SetType(2)" class="ButtonTypes"> 
            <img src="Sprites/Buttons/WingButton.png" id = "Wings" class="TypeImg">
        </button>
    </div>

    <div id = "Rbuttons" class = "SideMenu">
        <button onclick="RotateObj()" class="ButtonTypes"> 
            <img src="Sprites/Buttons/RotateButton.png" id = "Rotate" class="TypeImg">
        </button>
        <button onclick="MirrorObj()" class="ButtonTypes"> 
            <img src="Sprites/Buttons/MirrorButton.png" id = "Mirror" class="TypeImg">
        </button>
        <button onclick = "Delete()" class="ButtonTypes" id="Delete">
            <img src="Sprites/buttons/DeleteButton.png" class="TypeImg"> 
        </button>
        <button onclick = "Confirm()" class="ButtonTypes" id="Delete">
            <img src="Sprites/buttons/ReadyButton.png" class="TypeImg"> 
        </button>
    </div>
</div>

<div id = "Controller" style = "display: none">
        <div class = "cont" onclick="Go()" style="width: 50%; height: 100%; float: left;"></div> 
        <div class = "cont" onclick="Fire()" style="width: 50%; height: 100%; float: right;"></div> 
</div>

<script src="JS/ShipBuilder.js"></script>
<script src="JS/Controller.js"></script>
<script src="JS/CreateShip.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    (function(){
        var socket = io();
        var keys = [];
        var inputSeq = 0;
        var controllerCode = "";

        function update(){
            handleInput()
            window.requestAnimationFrame(update);
        }
        window.onload = function(){
            socket.emit("createController");
        }

        socket.on('connected', function(uid){
            console.log(uid);
            controllerCode = uid;
            update();
        });

        function handleInput(){
            var input = [];
            if(keys[68]){
                input.push("r");
            }
            if(keys[65]){
                input.push("l");
            }
            //console.log(input);
            if(input.length && controllerCode != ""){
                inputSeq += 1;
                socket.emit("receiveInput", controllerCode, input, new Date().getTime(), inputSeq);
            }
        }
        window.onkeydown = function(e){
            console.log(e);
            keys[e.keyCode] = true; 
        }
        window.onkeyup = function(e){
            keys[e.keyCode] = false;
        }
    })();
</script>
</body>
</html>